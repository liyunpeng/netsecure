[TOC]
#### 用户管理 
 
原力矿池后台管理系统 
账号:lf
密码；a1234567

有收益分配权限的用户：
ax  
Aa1234567

超级管理员 ； 
 
Aa1234567


用于系统：
有算力的用户：
18621150601   ipfs2018



####  运行匡持， 运行一段时间后，产生待分配

添加一个矿池：
![-w1275](media/15997951645803.jpg)

一般一天之后才能触发， 如果提前触发， 修改mining_time时间：
![-w1395](media/15997953580697.jpg)
对应的数据库定义：
![-w1243](media/15997958048818.jpg)
![-w903](media/15997960859731.jpg)



需要filscan那边确认， 可能会报error

最后在分配收益申请里， 产生一条待分配的记录：
![-w1909](media/15997954568563.jpg)


然后到提现申请里， 对这条待分配的收益， 做提现申请：
![-w1909](media/15997955332407.jpg)


### decimal 最多保持小数点后16位
12345.67890 12345 67890 1

```golang
func main() {
	//25 位数
	d, _ := decimal.NewFromString("1234567890123456789012345")
	fmt.Println("d = ", d)
	d2 := decimal.NewFromInt(10)

	d4 := d2.Pow(decimal.NewFromInt(20))
	
	a, _ := d4.Float64()
	fmt.Println("a= ", a )
	d3 := d.Div(d4)

	d5 := d3.Truncate(7)

	fmt.Println("d3 = ", d3)
	fmt.Println("d5 = ", d5)
}
```
结果：
![-w537](media/15998991641570.jpg)


#### 实际调试数据
```
Result = {gitlab.forceup.in/forcepool/admin/api/admin.AA·2} 
 TotalReward = {string} "206113286568752109579"
 StartHeight = {int64} 53041
 EndHeight = {int64} 53158

result = {gitlab.forceup.in/forcepool/admin/api/admin.WalletRewards} 
 Code = {int} 3
 Msg = {string} "ok"
 Data = {struct { Income float64 "json:\"income\""; Rewards float64 "json:\"rewards\""; StartHeight int64 "json:\"Max\""; EndHeight int64 "json:\"Min\"" }} 
  Income = {float64} 206.1132865687521
  Rewards = {float64} 206.1132865687521
  StartHeight = {int64} 53041
  EndHeight = {int64} 0
```
  
传入的autofil为206113286568752109579， 规整一下， 
206 113 28656 87521 09579
共3 + 18 位， 
decimal 转换后， 得到：
206.1132865687521 规整一下： 
206.113 28656 87521
小数点后为13位， decimal最多容纳13位小数。 


#### pre request 


var card = CryptoJS.enc.Utf8.parse("11111")
var base64 = CryptoJS.enc.base64.stringify(card)
pm.environment.set("cardNumber", base64)  
  
  
  var card = CryptoJS.enc.Utf8.parse("11111")
var base64 = CryptoJS.enc.Base64.stringify(card)
pm.environment.set("cardNumber", base64) 

![-w1407](media/16000760594155.jpg)


#### 超级管理员
![-w1652](media/16003913781736.jpg)


![-w1656](media/16003915061713.jpg)

#### API发消息
消息发不到链上的原因是， 消息的baselimit太小导致。 




### 收益分配申请
ax 没有收益分配的权限, 只能提交收益分配申请
待分配 申请： 
![-w1715](media/16009193470122.jpg)

收益校验：
![-w1715](media/16009193887142.jpg)
产品收益 和 矿池空间： 

![-w1715](media/16009194696376.jpg)

提交申请： 
![-w1715](media/16009195764527.jpg)

ax提交申请后， 进入审核中： 
![-w1331](media/16007398744850.jpg)


### 收益分配的审核
lf： 有收益分配的审核权限，审核通过。 待lf 对收益分配进行审核： 
![-w1479](media/16007399507924.jpg)
 
 需要输入密码，才可以审核通过
![-w1479](media/16007400360897.jpg)



审核确认后， 需要很长时间的等待， 因为在写数据库
![-w1479](media/16007402567674.jpg)

审核后， 大量的user_notify 插入语句：
![-w1707](media/16007407204738.jpg)


### 提现相关的表
从API找到待打款列表：
![-w1457](media/16007530118450.jpg)

所有的表都通过user_code关联
#### 转账订单表
每个待打款， 就是一个转账订单， 用上面的订单id,到currency_transfer找到这个订单：
SELECT * from currency_transfer WHERE id=15929;
![-w1507](media/16007534128532.jpg)
currency_transfer记录了订单状态， 转账金额， 转账消息的cid, 转账的目标T3地址， 用户每申请一次提现， 就在这个表里产生一条记录。 

#### 提现的表
![-w1507](media/16007536157223.jpg)
主要是发起提现的用户的名字， 用户的钱包T3地址

#### balance表
![-w732](media/16007538396462.jpg)

主要包括用户总的金额， 冻结的金额， 可用的金额， 
主要用于校验用。 


####  堆栈数据没有出来
![-w1753](media/16007656103433.jpg)


#### singleTask
审核通过起一个任务的写法：
![-w1455](media/16007660768979.jpg)
  对应的singleTask:  
![-w1196](media/16007661496769.jpg)

避免一个任务没完成， 又执行下一个任务。 


#### 按结构体里指定字段排序
![-w1196](media/16008254778851.jpg)

#### mac 查端口是否被占用
![-w949](media/16008400714448.jpg)


#### npm run dev 错误
![-w1313](media/16008419174799.jpg)

解决的办法是：
npm uninstall 后， 再 npm install ， 再npm run dev 就好了： 

![-w1435](media/16008420528165.jpg)






### 清空表
```
UPDATE pool SET mining_time = null, is_mining = 0;
UPDATE product SET mining_time = null;
DELETE from `pool_income`;
DELETE from `pool_wallet_income`;
DELETE from `pool_income_audit`;
DELETE from `pool_product_income`;
DELETE from `pool_user_income`;
DELETE FROM currency_transfer WHERE currency_flag = 2 and operation_flag = 3;
DELETE FROM currency_transfer WHERE currency_flag = 2 and operation_flag = 2;
UPDATE balance SET total_balance = 0, frozen = 0, free = 0 WHERE coin_type = 2;
DELETE from `wallet`;
DELETE FROM withdraw_wallet WHERE coin_type = 2;
DELETE from `user_notify`;
DELETE from `balance_verify_record`;
```