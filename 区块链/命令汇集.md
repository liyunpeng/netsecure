### 配置文件

#### server 的配置
```
$ cat config.json
{
  "port": "3456",
  "dbConfig": {
    "dbConnString": "root:Ipfs@123ky@tcp(10.10.19.15:3306)/lotus17?loc=Local&parseTime=true",
    "dbType": "mysql",
    "dbDebugMode": true
  },
  "sealerSleepDurationSeconds":60,
  "lockLifeCircleMinutes": 40,
  "sectorStoreZoneMap": {
    "2048": 3078,
    "8388608": 12582912,
    "34359738368": 51539607552,
    "536870912": 805306368
  }
}
```

#### worker的配置
32G 和512 的worker config, 除了sectorsize不一样，其他一样
```
$ cat config.toml
scheduler_url = "http://10.10.19.17:3456"
local_dir = "/sealer"
copy_limit_mb_per_sec = 500
group_id= [1]
sector_size = 536870912
ip = "10.10.19.17"

[[worker]]
num = 1
supported_phase = ["PreCommitPhase1","PreCommitPhase2","CommitPhase1","CommitPhase2"]
wait_sec = 60

[[worker]]
num = 1
supported_phase = ["CopyTask","CleanTask"]
wait_sec = 60
```

###  命令的环境变量
forcework 设置项： 
512M的FIL_PROOFS_MAXIMIZE_CACHING=false
32G的FIL_PROOFS_MAXIMIZE_CACHING为 1 或者 true

单位：
8M=8388608
512M=536870912
32G=34359738368
34359738368

FIL_PROOFS_MAXIMIZE_CACHING=true FIL_PROOFS_ALLOW_GENERATING_GROTH=1 RUST_LOG=trace BELLMAN_PROOF_THREADS=3 RUST_BACKTRACE=1 nohup ./force-remote-worker > force-remote-worker.log 2>&1 &    
 
 
### 创世节点
```
./lotus fetch-params  8388608
./lotus-seed pre-seal --sector-size  8388608  --num-sectors 5
./lotus-seed genesis new localnet.json
./lotus-seed genesis add-miner localnet.json ~/.genesis-sectors/pre-seal-t01000.json
nohup ./lotus daemon --lotus-make-genesis=dev.gen --genesis-template=localnet.json --bootstrap=false > lotus.log 2>&1 &
./lotus wallet import ~/.genesis-sectors/pre-seal-t01000.key
./lotus-storage-miner init --genesis-miner --actor=t01000 --sector-size=8388608 --pre-sealed-sectors=~/.genesis-sectors --pre-sealed-metadata=~/.genesis-sectors/pre-seal-t01000.json --nosync
nohup ./lotus-storage-miner run --nosync >miner.log 2>&1 &
./lotus-storage-miner fconfig autogarbage false
./lotus wallet set-default  t3地址
```

### 私链搭建

#### 启动lotus 
```
第一次启动lotus
nohup ./lotus daemon --genesis=./dev.gen --bootstrap=false --api 11234 > lotus.log 2>&1 & 
```

#### 链同步
```
./lotus sync wait  只有链同步成功了， 才可以miner 初始化
```

#### 给矿工转钱
```
./lotus wallet new bls

$ ./lotus state get-actor t3wj3dfbxnqfzjlgtq7yma66tmkdkc7p4bf2cmrtpw4gewvz5dvbsg6ws5nfk2otvm7a5ll2p3ts5rkjps3eia      
Address:        t3wj3dfbxnqfzjlgtq7yma66tmkdkc7p4bf2cmrtpw4gewvz5dvbsg6ws5nfk2otvm7a5ll2p3ts5rkjps3eia
Balance:        500
Nonce:          0
Code:           bafkqadlgnfwc6mjpmfrwg33vnz2a
Head:           bafy2bzacedhvunyze3fak2sfb7gnkpdn42ya4glnrlrgziifbenudxg4koj56
```

#### miner 初始化
初始化必须在链同步之后， 因为初始化要拿链上的信息
```
owner 是t3的初始化, 耗时5分钟
./lotus-storage-miner init --nosync --sector-size=536870912 --owner=t3qr64ae6azjwqewl5ivsyy7dvw73evaerkkiipavd3uqwyz7ybmpp2nxmbfr6r5jgrifmwjq2hnvsclgdpwma

ownee是t0的初始化  这个步骤是非常快的
./lotus-storage-miner init  --nosync --owner=t01002
```

#### 重启server 

```
nohup ./lotus-server >lotus-server.log 2>&1 &
第二次启动lotus
nohup ./lotus daemon --server-api=http://10.10.10.207:3456 --bootstrap=false --api 11234 > lotus.log 2>&1 &
```

#### poster 
```
nohup ./lotus-storage-miner run --mode=poster --server-api=http://10.10.10.207:3456 --dist-path=/mnt --nosync > poster.log 2>&1 &
```

针对worker耗时不同而用的sealer不同启动方式
32G的sealer和worker
```
HACK_P1=1   FIL_PROOFS_MAXIMIZE_CACHING=1  FIL_PROOFS_NUMS_OF_PARTITION_HACK=4  FIL_PROOFS_USE_FULL_GROTH_PARAMS=true  BELLMAN_PROOF_THREADS=8  RUST_LOG=debug  RUST_BACKTRACE=full   nohup ./force-remote-worker >> logs/force-remote-worker.log 2>&1 &
FORCE_BUILDER_P1_WORKERS=1  FORCE_BUILDER_TASK_DELAY=1h  FORCE_BUILDER_AUTO_PLEDGE_INTERVAL=10  TRUST_PARAMS=1 RUST_LOG=info RUST_BACKTRACE=1  FORCE_BUILDER_PLEDGE_TASK_TOTAL_NUM=1 nohup ./lotus-storage-miner run     --mode=remote-sealer --server-api=http://10.10.10.239:3456 --dist-path=/mnt  --nosync   --groups=1 > logs/sealer.log 2>&1 &
```

512M的sealer和worker
```
FIL_PROOFS_MAXIMIZE_CACHING=false FIL_PROOFS_ALLOW_GENERATING_GROTH=1 RUST_LOG=debug BELLMAN_PROOF_THREADS=3 RUST_BACKTRACE=1 nohup ./force-remote-worker > force-remote-worker.log 2>&1 &
FORCE_BUILDER_P1_WORKERS=28 FORCE_BUILDER_TASK_DELAY=1s FORCE_BUILDER_AUTO_PLEDGE_INTERVAL=1 TRUST_PARAMS=1 RUST_LOG=info RUST_BACKTRACE=1 FORCE_BUILDER_PLEDGE_TASK_TOTAL_NUM=56 nohup ./lotus-storage-miner run --mode=remote-sealer --server-api=http://10.10.10.207:3456 --dist-path=/mnt --nosync --groups=1 > ./sealer.log 2>&1 &
```

### 同步命令
#### ansible
```
ansible-playbook -i hosts-storage-6-22 test.yml -f 30

ansible-playbook -i hosts-storage-6-22 03storage_node_init.yml --step

ansible nodes-all -m shell -a "ps -ef|grep force |grep -v grep "
 
ansible ligang -m copy -a "src=/home/cmd/config.toml dest=/home/fil/ owner=fil group=fil"
 
ansible yz-0-19  -m shell -a "mount -t nfs -o hard,nolock,rw,user,rsize=1048576,wsize=1048576,vers=3 10.10.7.31:/sealer   /sealer"

ansible ligang -m copy -a "src=/home/cmd/config.toml dest=/home/fil/ owner=fil group=fil"
```

加入一个机会组：10多台机器。 :
```
# vi /etc/ansible/hosts
```

#### scp
### 数据库
mysql -uroot -pIpfs@123ky
mysql> create database `lotus17a` ；
mysql> exit 

### linux基本命令：

文件系统：
mount -t nfs -o hard,nolock,rw,user,rsize=1048576,wsize=1048576,vers=3 10.10.13.22:/mnt/storage  /mnt/

文件查看：
tail -100f lotus-server.log

版本查看
```
[root@yangzhou010010019017 ~]# cat /etc/redhat-release
CentOS Linux release 7.6.1810 (Core)

md5sum 文件名
``` 

配置查看
```
[fil@yangzhou010010001015 ~]$ cat /proc/cpuinfo| grep "cpu cores"| uniq
cpu cores	: 10
[fil@yangzhou010010001015 ~]$ grep MemTotal /proc/meminfo
MemTotal:       32818656 kB

free -h 
```

文件大小查看
```
du -sch *
```

进程查看
只查看本用户启动的进程
ps -x
查看所有进程
ps -ef






